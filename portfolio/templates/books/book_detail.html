{% extends 'base.html' %}
{% load static %}

{% block title %}{{ book.title }} by {{ book.author }} - Robert Sichomba's Books{% endblock title %}

{% block meta_description %}{{ book.summary|truncatechars:160 }}{% endblock meta_description %}

{% block content %}
    {# Book Detail Section #}
    <section class="py-5">
        <div class="container my-5">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'books_list' %}">Books</a></li>
                    <li class="breadcrumb-item active" aria-current="page">{{ book.title }}</li>
                </ol>
            </nav>

            <div class="row gx-5 align-items-center">
                {# Book Cover Image Column #}
                <div class="col-md-4 text-center mb-4 mb-md-0" data-animate>
                    {% if book.cover_image %}
                        <img src="{{ book.cover_image.url }}" class="img-fluid rounded shadow-lg book-detail-cover" alt="Cover of {{ book.title }}">
                    {% else %}
                        <img src="{% static 'images/default_book_cover.jpg' %}" class="img-fluid rounded shadow-lg book-detail-cover" alt="Default book cover">
                    {% endif %}
                </div>

                {# Book Details Column #}
                <div class="col-md-8" data-animate>
                    <h1 class="display-5 fw-bold mb-3">{{ book.title }}</h1>
                    <p class="lead text-muted mb-4">
                        <i class="fas fa-user-edit me-2"></i>By <span class="fw-bold">{{ book.author }}</span>
                        {% if book.publication_year %}<span class="ms-3"><i class="fas fa-calendar-alt me-2"></i>Published: {{ book.publication_year }}</span>{% endif %}
                    </p>

                    <p class="mb-4">{{ book.summary }}</p>

                    <div class="book-info mb-4">
                        {% if book.isbn %}<p class="mb-1"><strong>ISBN:</strong> {{ book.isbn }}</p>{% endif %}
                        {% if book.publisher %}<p class="mb-1"><strong>Publisher:</strong> {{ book.publisher }}</p>{% endif %}
                        {% if book.genre %}<p class="mb-1"><strong>Genre:</strong> {{ book.genre }}</p>{% endif %} {# Assuming genre is a CharField or similar #}
                        {# If using tags for genre/topics, use the tags section below instead #}
                    </div>

                    {% if book.tags.all %}
                    <div class="mb-4">
                        <h6 class="fw-bold">Topics:</h6>
                        {% for tag in book.tags.all %}
                            {# Assuming you'll set up a URL for book tags if needed, otherwise just display #}
                            <span class="badge bg-secondary text-decoration-none me-1 mb-1">{{ tag.name }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}

                    {% if book.purchase_link %}
                        <a href="{{ book.purchase_link }}" target="_blank" rel="noopener noreferrer" class="btn btn-primary btn-lg me-3">
                            Buy Now <i class="fas fa-external-link-alt ms-2"></i>
                        </a>
                    {% endif %}
                    <a href="{% url 'books_list' %}" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-arrow-left me-2"></i> Back to Books
                    </a>
                </div>
            </div>

            <hr class="my-5">

            {# Full Book Description/Content #}
            <div class="book-full-description" data-animate>
                <h3 class="fw-bold mb-4">Full Description</h3>
                <div class="lead-text">
                    {{ book.description|safe }} {# Use |safe if your description contains HTML #}
                </div>
            </div>

            {# --- Access Level Warning (if not public) --- #}
            {% if book.access_level != 'public' %}
                {% if not user.is_authenticated %}
                <div class="alert alert-warning mt-5 text-center" role="alert">
                    <i class="fas fa-lock me-2"></i> This content is for **Registered Users Only**. Please <a href="{% url 'login' %}" class="alert-link">log in</a> or <a href="{% url 'signup' %}" class="alert-link">sign up</a> to view the full details.
                </div>
                {% elif book.access_level == 'private' and not user.is_superuser and not user.is_staff %}
                <div class="alert alert-danger mt-5 text-center" role="alert">
                    <i class="fas fa-user-lock me-2"></i> This content is **Private (Admin Only)**. You do not have permission to view it.
                </div>
                {% endif %}
            {% endif %}

        </div>
    </section>

    {# Optional: Related Books Section (if you implement it) #}

    <section class="py-5 bg-light" data-animate>
        <div class="container my-5">
            <h3 class="text-center fw-bold mb-5">Related Books</h3>
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {# Loop through related books here #}
            </div>
        </div>
    </section>


    {# Call to Action for Other Resources #}
    <section class="py-5 bg-dark text-white text-center" data-animate>
        <div class="container my-5">
            <div class="col-lg-8 mx-auto">
                <h2 class="fw-bold mb-4">Discover More from My Library</h2>
                <p class="lead mb-4">
                    Explore more of my curated content, including insightful blog posts, detailed notes, and important documents.
                </p>
                <a href="{% url 'blog_list' %}" class="btn btn-primary btn-lg me-3">Visit My Blog <i class="fas fa-newspaper ms-2"></i></a>
                <a href="{% url 'notes_list' %}" class="btn btn-outline-light btn-lg">Browse Notes <i class="fas fa-sticky-note ms-2"></i></a>
            </div>
        </div>
    </section>
{% endblock content %}

{% block extra_head %}
<style>
    .book-detail-cover {
        max-width: 300px; /* Adjust as needed */
        height: auto;
        display: block;
        margin-left: auto;
        margin-right: auto;
    }
    .book-info p {
        font-size: 0.95rem;
    }
    .lead-text p { /* For styling the actual description content */
        font-size: 1.1rem;
        line-height: 1.8;
        color: #495057;
    }
</style>
{% endblock extra_head %}